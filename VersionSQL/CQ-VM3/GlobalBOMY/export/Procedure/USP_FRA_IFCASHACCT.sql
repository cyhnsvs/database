/****** Object:  Procedure [export].[USP_FRA_IFCASHACCT]    Committed by VersionSQL https://www.versionsql.com ******/

CREATE PROCEDURE [export].[USP_FRA_IFCASHACCT]
(
	@idteProcessDate DATE
)
AS
BEGIN

	SET NOCOUNT ON;

	CREATE TABLE #IFCASHACCT
	(
		CASHACKEY DECIMAL(11,0),
		COMPANYID CHAR(1),
		BRANCHID CHAR(4),
		EAFID CHAR(3),
		ACCTNO CHAR(10),
		ACCTSBNO CHAR(4),
		CUSTKEY CHAR(10),
		CURRCODE CHAR(3),
		SUBACCTTYP CHAR(2),
		TRXCD CHAR(2),
		ORGCOMPANY CHAR(1),
		ORGBRANCH CHAR(4),
		ORGEAFID CHAR(3),
		CHRGCD CHAR(3),
		INTTRXID DECIMAL(11,0),
		TRXSUBCD CHAR(1),
		TRXREFNO CHAR(10),
		TRXREFSX CHAR(3),
		TRXREFVS DECIMAL(3,0),
		TRXDT DATE,
		TRXVLDT DATE,
		TRXAMT DECIMAL(15,2),
		TRXAMTL DECIMAL(15,2),
		TRXEXRT DECIMAL(9,6),
		TRXQTY DECIMAL(9,0),
		BNKCOMMAMT DECIMAL(9,2),
		BNKCOMMPD DECIMAL(9,2),
		VATAMT DECIMAL(9,2),
		APPCOMPANY CHAR(1),
		APPBRANCH CHAR(4),
		APPEAFID CHAR(3),
		APPTXCD CHAR(2),
		APPTXSUB CHAR(1),
		APPTXREF CHAR(10),
		APPTXREFSX CHAR(3),
		APPTXREFVS DECIMAL(3,0),
		CHEQUECD CHAR(1),
		SETTCURR CHAR(3),
		SETTMODECD CHAR(2),
		SETTAMT DECIMAL(15,2),
		SETTEXRT DECIMAL(9,6),
		SETTBANK CHAR(50),
		SETTREF CHAR(15),
		CANCELIND CHAR(1),
		PARTICULAR CHAR(50),
		RELDOCNO CHAR(15),
		FINPD DECIMAL(2,0),
		FINYR DECIMAL(4,0),
		CURAPPDT DATE,
		BANKCD CHAR(4),
		BANKBRANCH CHAR(10),
		CBCOMPANY CHAR(1),
		CBBRANCH CHAR(4),
		CASHBKID CHAR(3),
		CBTRXKEY DECIMAL(11,0),
		CANCELTNR CHAR(4),
		REJECTIONR CHAR(4),
		CHEQUEDT DATE,
		BANKINREF CHAR(10),
		USRENTERED CHAR(10),
		DTENTERED DATE,
		TMENTERED CHAR(8),
		USRCHECKED CHAR(10),
		DTCHECKED DATE,
		TMCHECKED CHAR(8),
		USRPOSTED CHAR(10),
		DTPOSTED DATE,
		TMPOSTED CHAR(8),
		USRAPPROVE CHAR(10),
		DTAPPROVED DATE,
		TMAPPROVED CHAR(8),
		WRKSTN CHAR(10),
		RCDSTAT CHAR(1),
		RCDVERSION DECIMAL(5,0),
		PGMLSTUPD CHAR(10),
		TRIGGERACT CHAR(1),
		CHKRACTION CHAR(1),
		APPSTATUS CHAR(1),
		AMOUNT1 DECIMAL(15,2),
		AMOUNT2 DECIMAL(15,2),
		AMOUNT3 DECIMAL(15,2),
		DATE1 DATE,
		DATE2 DATE,
		QUANTITY1 DECIMAL(9,0),
		QUANTITY2 DECIMAL(9,0),
		QUANTITY3 DECIMAL(9,0),
		DTDUEPAY DATE,
		APPTXDT DATE,
		ALCOMPANY CHAR(1),
		ALBRANCH CHAR(4),
		ALEAFID CHAR(3),
		ALACCTNO CHAR(10),
		ALACCTSBNO CHAR(4),
		TRXCOMPANY CHAR(1),
		TRXBRANCH CHAR(4),
		TRXEAFID CHAR(3),
		REMARK1 CHAR(50),
		VALGIVEN CHAR(1),
		CQCOLDT DATE,
		BATCHTP CHAR(2),
		BATCHNO DECIMAL(8,0),
		DOCREF1 CHAR(20),
		DOCREF2 CHAR(20),
		SWIFTREF CHAR(20),
		ACCTGRPCD CHAR(5),
		MCDREFNO CHAR(30),
		CMPBEARAMT DECIMAL(15,2),
		BNKCOMMAMD DECIMAL(9,2),
		GRPPRFID CHAR(10),
		OFFICERCD CHAR(10),
		DLRBEARAMT DECIMAL(15,2),
		DLRBEAR CHAR(1),
		DLRBEARDT DATE,
		INTMETHOD CHAR(1),
		SETTBANKAC CHAR(20),
		SETTACCTNM CHAR(60),
		ACCTTYPECD CHAR(2),
		TEXT1 CHAR(10),
		TEXT2 CHAR(10),
		TEXT3 CHAR(10),
		DATE3 DATE,
		DATE4 DATE,
		DATE5 DATE,
		AMOUNT4 DECIMAL(15,2),
		AMOUNT5 DECIMAL(15,2),
		PARACGRPCD CHAR(5)
	)

	INSERT INTO #IFCASHACCT
	(
		CASHACKEY,
		COMPANYID,
		BRANCHID,
		EAFID,
		ACCTNO,
		ACCTSBNO,
		CUSTKEY,
		CURRCODE,
		SUBACCTTYP,
		TRXCD,
		ORGCOMPANY,
		ORGBRANCH,
		ORGEAFID,
		CHRGCD,
		INTTRXID,
		TRXSUBCD,
		TRXREFNO,
		TRXREFSX,
		TRXREFVS,
		TRXDT,
		TRXVLDT,
		TRXAMT,
		TRXAMTL,
		TRXEXRT,
		TRXQTY,
		BNKCOMMAMT,
		BNKCOMMPD,
		VATAMT,
		APPCOMPANY,
		APPBRANCH,
		APPEAFID,
		APPTXCD,
		APPTXSUB,
		APPTXREF,
		APPTXREFSX,
		APPTXREFVS,
		CHEQUECD,
		SETTCURR,
		SETTMODECD,
		SETTAMT,
		SETTEXRT,
		SETTBANK,
		SETTREF,
		CANCELIND,
		PARTICULAR,
		RELDOCNO,
		FINPD,
		FINYR,
		CURAPPDT,
		BANKCD,
		BANKBRANCH,
		CBCOMPANY,
		CBBRANCH,
		CASHBKID,
		CBTRXKEY,
		CANCELTNR,
		REJECTIONR,
		CHEQUEDT,
		BANKINREF,
		USRENTERED,
		DTENTERED,
		TMENTERED,
		USRCHECKED,
		DTCHECKED,
		TMCHECKED,
		USRPOSTED,
		DTPOSTED,
		TMPOSTED,
		USRAPPROVE,
		DTAPPROVED,
		TMAPPROVED,
		WRKSTN,
		RCDSTAT,
		RCDVERSION,
		PGMLSTUPD,
		TRIGGERACT,
		CHKRACTION,
		APPSTATUS,
		AMOUNT1,
		AMOUNT2,
		AMOUNT3,
		DATE1,
		DATE2,
		QUANTITY1,
		QUANTITY2,
		QUANTITY3,
		DTDUEPAY,
		APPTXDT,
		ALCOMPANY,
		ALBRANCH,
		ALEAFID,
		ALACCTNO,
		ALACCTSBNO,
		TRXCOMPANY,
		TRXBRANCH,
		TRXEAFID,
		REMARK1,
		VALGIVEN,
		CQCOLDT,
		BATCHTP,
		BATCHNO,
		DOCREF1,
		DOCREF2,
		SWIFTREF,
		ACCTGRPCD,
		MCDREFNO,
		CMPBEARAMT,
		BNKCOMMAMD,
		GRPPRFID,
		OFFICERCD,
		DLRBEARAMT,
		DLRBEAR,
		DLRBEARDT,
		INTMETHOD,
		SETTBANKAC,
		SETTACCTNM,
		ACCTTYPECD,
		TEXT1,
		TEXT2,
		TEXT3,
		DATE3,
		DATE4,
		DATE5,
		AMOUNT4,
		AMOUNT5,
		PARACGRPCD
	)
	SELECT 
	   '',
	   '',
	   TRANSSETTL.BatchId,
	   '',
	   TRANSSETTL.AcctNo,
	   '',
	   '',
	   TRANSSETTL.TradedCurrCd,
	   '',
	   '',----TRXCD --10

	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   TRANSSETTL.ContractNo,
	   '',
	   '',
	   TRANSSETTL.TradeDate,--20

       '',
	   TRANSSETTL.NetAmountSetl,--TRXAMT
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',--30

	   '',
	   '',--APPTXCD
	   '',
	   '',
	   '',
	   '',
	   '',--CHEQUECD
	   '',
	   '',
	   '',--40

       '',
	   '',--SETTBANK
	   '',--SETTREF
	   (CASE WHEN CONTRACTAMEN.ContractAmendNo=0 THEN 'N' ELSE 'Y' END) AS CANCELIND,--CANCELIND
	   '',--PARTICULAR
	   '',--RELDOCNO
	   '',
	   '',
	   '',
	   '',--50

       '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',--60

       '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',--70

       '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',--80

       '',
	   '',
	   '',
	   '',
	   Branch.[BranchLocation (textinput-2)],--TRXBRANCH
	   '',
	   '',
	   '',
	   '',
	   '',--90

       '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',--100

	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',
	   '',--110

	   '',
	   '',
	   '',
	   '',
	   '',
	   '',--SETTACCTNM
	   '',
	   '',
	   '',
	   '',--120

	   '',
	   '',
	   '',
	   '',
	   '',
	   Acc.[ParentGroup (selectsource-3)]--PARACGRPCD
	FROM CQBTempDB.export.tb_formdata_1409 Acc
	INNER JOIN GlobalBO.transmanagement.Tb_TransactionsSettled TRANSSETTL ON TRANSSETTL.AcctNo = Acc.[AccountNumber (textinput-5)]
	INNER JOIN CQBTempDB.export.tb_formdata_1377 Dealer ON Dealer.[DealerCode (textinput-35)] = Acc.[DealerCode (selectsource-21)]
	INNER JOIN CQBTempDB.export.tb_formdata_1374 Branch ON Branch.[BranchID (textinput-1)] = Dealer.[BranchID (selectsource-1)]
	INNER JOIN GlobalBO.Contracts.Tb_ContractOutstanding CONTRACTAMEN ON CONTRACTAMEN.AcctNo = Acc.[AccountNumber (textinput-5)]
	WHERE TRANSSETTL.TRANSTYPE IN ('CHDP','CHWD')


	-- RESULT SET
	SELECT 
		 CAST(CASHACKEY AS CHAR(8)) + COMPANYID + BRANCHID + EAFID + ACCTNO + ACCTSBNO + CUSTKEY + CURRCODE + SUBACCTTYP + TRXCD + ORGCOMPANY +
		ORGBRANCH + ORGEAFID + CHRGCD + CAST(INTTRXID AS CHAR(8)) + TRXSUBCD + TRXREFNO + TRXREFSX + CAST(TRXREFVS AS CHAR(8)) + TRXDT + TRXVLDT + CAST(TRXAMT AS CHAR(8)) +
		CAST(TRXAMTL AS CHAR(8)) + CAST(TRXEXRT AS CHAR(8)) + CAST(TRXQTY AS CHAR(8)) + CAST(BNKCOMMAMT AS CHAR(8)) + CAST(BNKCOMMPD AS CHAR(8)) + CAST(VATAMT AS CHAR(8)) + APPCOMPANY + APPBRANCH + APPEAFID + APPTXCD +
		APPTXSUB + APPTXREF + APPTXREFSX + CAST(APPTXREFVS AS CHAR(8)) + CHEQUECD + SETTCURR + SETTMODECD + CAST(SETTAMT AS CHAR(8)) + CAST(SETTEXRT AS CHAR(8)) + SETTBANK +
		SETTREF + CANCELIND + PARTICULAR + RELDOCNO + CAST(FINPD AS CHAR(8)) + CAST(FINYR AS CHAR(8)) + CURAPPDT + BANKCD + BANKBRANCH + CBCOMPANY + CBBRANCH +
		CASHBKID + CAST(CBTRXKEY AS CHAR(8)) + CANCELTNR + REJECTIONR + CHEQUEDT + BANKINREF + USRENTERED + DTENTERED + TMENTERED + USRCHECKED +
		DTCHECKED + TMCHECKED + USRPOSTED + DTPOSTED + TMPOSTED + USRAPPROVE + DTAPPROVED + TMAPPROVED + WRKSTN + RCDSTAT +
		CAST(RCDVERSION AS CHAR(8)) + PGMLSTUPD + TRIGGERACT + CHKRACTION + APPSTATUS + CAST(AMOUNT1 AS CHAR(8)) + CAST(AMOUNT2 AS CHAR(8)) + CAST(AMOUNT3 AS CHAR(8)) + DATE1 + DATE2 +
		CAST(QUANTITY1 AS CHAR(8)) + CAST(QUANTITY2 AS CHAR(8)) + CAST(QUANTITY3 AS CHAR(8)) + DTDUEPAY + APPTXDT + ALCOMPANY + ALBRANCH + ALEAFID + ALACCTNO + ALACCTSBNO +
		TRXCOMPANY + TRXBRANCH + TRXEAFID + REMARK1 + VALGIVEN + CQCOLDT + BATCHTP + CAST(BATCHNO AS CHAR(8)) + DOCREF1 + DOCREF2 + SWIFTREF +
		ACCTGRPCD + MCDREFNO + CAST(CMPBEARAMT AS CHAR(8)) + CAST(BNKCOMMAMD AS CHAR(8)) + GRPPRFID + OFFICERCD + CAST(DLRBEARAMT AS CHAR(8)) + DLRBEAR + DLRBEARDT + INTMETHOD +
		SETTBANKAC + SETTACCTNM + ACCTTYPECD + TEXT1 + TEXT2 + TEXT3 + DATE3 + DATE4 + DATE5 + CAST(AMOUNT4 AS CHAR(8)) + CAST(AMOUNT5 AS CHAR(8)) + PARACGRPCD
	FROM 
		#IFCASHACCT


END